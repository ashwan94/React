<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promise</title>
  </head>
  <body>
    <script>
      /* Promise ê°ì²´ : ì²˜ë¦¬ì— ì„±ê³µ ì‹œ ì‹¤í–‰í•  ì½œë°± í•¨ìˆ˜,
                          ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  ì½œë°± í•¨ìˆ˜ 
                          ìœ„ 2ê°€ì§€ë¥¼ ë¯¸ë¦¬ ì•½ì†
      */
     // í™œìš© ì‚¬ë¡€ : ê³µê³µ API ë¡œ íŠ¹ì •í•œ ì‹œê°„ì— js ë¥¼ ì‹¤í–‰í•´ data ë¥¼ DB ì— insert ê°€ëŠ¥
     // Promise ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ë°–ì— ì—†ë‹¤

      // resolve : ì„±ê³µ ì‹œ ì‹¤í–‰
      // reject : ì‹¤íŒ¨ ì‹œ ì‹¤í–‰

      // Producer & Consumer
      // Producer ì…ì¥
      // Promise ê°ì²´ ìƒì„±
      const promise = new Promise((resolve, reject) => {
        setTimeout(() => {
          // resolve("ì„±ê³µ");
          reject(new Error("ì‹¤íŒ¨")); // Error ê°ì²´ì— ë‹´ì•„ì¤Œ
        }, 2000);
      });

      // consumer ì…ì¥ : promise ì‚¬ìš©ì ê´€ì 
      // then : ì‹¤í–‰ ì„±ê³µ ì‹œ ì‘ë™
      // catch() : ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ì‘ë™
      // finally() : ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— ì‘ë™í•˜ëŠ” í•¨ìˆ˜
      promise
        .then((response) => {
          console.log(response);
        })
        .catch((err) => {
          console.log(err);
        })
        .finally(() => {
          console.log("ìµœì¢…");
        });

      // promise ì²´ì´ë‹
      const fetchNumber = new Promise((res, rej) => {
        setTimeout(() => res(1), 1000);
      });
      // then() ì˜ì—­ì—ëŠ” value ë¿ë§Œ ì•„ë‹ˆë¼ promise ê°ì²´ë„ ì „ë‹¬ ê°€ëŠ¥
      fetchNumber
        .then((num) => num * 2)
        .then((num) => num * 3)
        .then((num) => {
          return new Promise((res, rej) => {
            setTimeout(() => res(num), 1000);
          });
        })
        .then((res) => {
          console.log(res);
        });

      /* error í•¸ë“¤ë§ */
      const getHen = () => {
        return new Promise((res, rej) => {
          setTimeout(() => res("ğŸ“"), 1000);
        });
      };

      const getEgg = (hen) => {
        return new Promise((res, rej) => {
          setTimeout(() => res(`${hen} => 'ğŸ¥š'`), 1000);
        // setTimeout(() => rej(`error! ${hen} => 'ğŸ¥š'`), 1000);
        });
      };

      const getCook = (egg) => {
        return new Promise((res, rej) => {
          setTimeout(() => res(`${egg} => 'ğŸ³'`), 1000);
        });
      };

      getHen()
        .then((hen) => getEgg(hen)).catch((err) => {
            console.log(err);
            return "ğŸ™"
        })
        .then((egg) => getCook(egg))
        .then((meal) => console.log(meal)).catch()

        // ì¤‘ê°„ì— error ê°€ ë°œìƒí•˜ë©´ ë’¤ì— ì´ì–´ì§€ëŠ” then() ë“±ì´ ì „ë¶€ ì˜í–¥ì„ ë°›ëŠ”ë‹¤
        // ê·¸ëŸ¬ë¯€ë¡œ value ë¥¼ ì˜ ë„˜ê²¨ë°›ì•„ data ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ error ì— ëŒ€í•´ return ìœ¼ë¡œ value ë¥¼ ë„˜ê²¨ì¤˜ì•¼í•œë‹¤

        getHen().then(getEgg).then(getCook).then(console.log);
    </script>
  </body>
</html>
